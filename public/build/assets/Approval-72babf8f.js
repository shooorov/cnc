import{K as B,T as M,o as d,c as S,w as R,a as g,u as s,Z as q,b as t,f as l,n as m,t as r,g as y,i as K,x as U,r as k,F as j}from"./app-05106c13.js";import{_ as E}from"./GuestLayout-c571f5a4.js";import{_ as I}from"./Listbox-00d2fff9.js";import{_ as L}from"./Alert-347e11bb.js";import{_ as A}from"./InputError-d0e0b905.js";import"./_commonjsHelpers-de833af9.js";import"./ChevronUpDownIcon-0e86cfb8.js";import"./use-outside-click-40f4ba09.js";import"./use-text-value-1750268b.js";import"./hidden-f9f3699b.js";import"./use-controllable-b83185a4.js";import"./XMarkIcon-9b6fa05a.js";const P=t("div",{class:"mb-4 text-sm text-gray-600"}," This is a secure area of the application. Only admin can view this page. ",-1),Q={class:"mb-4 text-sm"},Z={key:0},G={class:"py-1 whitespace-nowrap font-bold text-base text-left"},H={class:"sm:flex sm:items-start mt-5"},J={class:"text-lg font-medium leading-6 text-gray-900"},W={key:1,class:"mt-5 grid grid-cols-2 gap-1 text-xs"},X={class:"py-1 whitespace-nowrap sm:text-sm text-stone-500 text-left"},Y={class:"py-1 whitespace-nowrap sm:text-sm text-stone-500 text-left"},tt=["placeholder"],et={class:"sm:flex sm:items-start mt-5"},st={class:"w-full"},ot={class:"text-sm font-medium text-gray-500"},at={class:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2"},rt={class:"capitalize"},nt={class:"bg-white px-0 py-2 sm:grid sm:grid-cols-3 sm:gap-4']"},it=t("dt",{class:"text-sm font-medium text-gray-500"}," Sub Total ",-1),ct={class:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2"},dt={class:"capitalize"},lt={class:"bg-gray-50 px-0 py-2 sm:grid sm:grid-cols-3 sm:gap-4']"},mt=t("dt",{class:"text-sm font-medium text-gray-500"}," Discount ",-1),ut={class:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2"},pt={class:"capitalize"},_t={class:"bg-white px-0 py-2 sm:grid sm:grid-cols-3 sm:gap-4']"},gt=t("dt",{class:"text-sm font-medium text-gray-500"}," VAT ",-1),xt={class:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2"},ht={class:"capitalize"},bt={class:"bg-gray-50 px-0 py-2 sm:grid sm:grid-cols-3 sm:gap-4']"},yt=t("dt",{class:"text-sm font-medium text-gray-500"}," Discount ",-1),ft={class:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2"},vt={class:"capitalize"},wt={class:"sm:flex sm:items-start mt-5"},kt={class:"text-lg font-medium leading-6 text-gray-900"},jt={class:"sm:flex sm:items-start mt-5"},At={class:"border-collapse table-auto w-full text-sm"},Nt=t("thead",null,[t("tr",null,[t("th",{class:"px-3 py-2 border-b bg-gray-100 text-xs font-bold uppercase tracking-wider text-left"},"Product"),t("th",{class:"px-3 py-2 border-b bg-gray-100 text-xs font-bold uppercase tracking-wider text-right"},"Rate"),t("th",{class:"px-3 py-2 border-b bg-gray-100 text-xs font-bold uppercase tracking-wider text-right"},"Qty"),t("th",{class:"px-3 py-2 border-b bg-gray-100 text-xs font-bold uppercase tracking-wider text-right"},"Total")])],-1),Ft={class:"bg-white"},Ot={class:"px-3 py-2 whitespace-wrap text-left"},Vt={class:"px-3 py-2 whitespace-wrap text-right"},Dt={class:"px-3 py-2 whitespace-wrap text-center"},Tt={class:"px-3 py-2 whitespace-wrap text-right"},zt={key:2,class:"mt-5 sm:mt-4 sm:flex sm:justify-between"},Ct=["disabled"],$t=["disabled"],Zt={__name:"Approval",props:{string_change:Object,setting:Object,branch:Object,order:Object,discount_types:Array,status:String,token:String},setup(i){const a=i,f=B(),e=M({order_id:a.order.id,sub_total:a.order.sub_total,discount_type:a.order.discount_type,discount_rate:a.order.discount_rate,discount_amount:a.order.discount_amount,vat_rate:a.order.vat_rate??5,vat_amount:a.order.vat_amount,total:a.order.total,status:"",token:a.token});e.group_items=a.order.products??[],e.total_text=e.sub_total+" - "+e.discount_amount+" + "+e.vat_amount+" = "+e.total;const N=[{name:"Date",value:a.order.date},{name:"Customer",value:a.order.customer_name},{name:"Manager",value:a.order.creator_name},{name:"Served By",value:a.order.waiter_name}],F=()=>{let u=Number(e.discount_rate),c=Number(e.vat_rate),o=e.group_items;console.log(o);let n=o.reduce((p,_)=>p+Number(_.rate)*Number(_.quantity),0)??0,b=o.filter(p=>!p.vat_applicable).reduce((p,_)=>p+Number(_.rate)*Number(_.quantity),0)??0,D=u/100,x=h(e.discount_type=="percent"?n*D:u),T=h(b>0?b/n*x:0),z=b-T,v=n-x-z,C=c/100,w=h(v*C),$=n-x+w;e.sub_total=n.toFixed(2),e.discount_amount=x.toFixed(2),e.vatable_amount=v.toFixed(2),e.vat_amount=w,e.total=$.toFixed(2),e.total_text=e.sub_total+" - "+e.discount_amount+" + "+e.vat_amount+" = "+e.total},h=u=>Math.round(u),O=()=>{confirm("Are you sure you want to Approve?")&&(f.props.alertMessage={},e.status="approved",e.post(route("order.approval.update"),{onFinish:()=>e.reset()}))},V=()=>{confirm("Are you sure you want to Reject?")&&(f.props.alertMessage={},e.status="rejected",e.post(route("order.approval.update"),{onFinish:()=>e.reset()}))};return(u,c)=>(d(),S(E,null,{default:R(()=>[g(s(q),{title:"Order Approval"}),P,t("div",Q,[g(L),i.status!="pending"?(d(),l("div",Z,[t("div",G,[t("p",{class:m([i.status=="approved"?"bg-green-500":"bg-red-500","py-2 px-3 text-white"])},"This order is "+r(i.status),3)])])):y("",!0),t("div",H,[t("h3",J," # Order need Approval ("+r(i.branch.name)+") ",1)]),i.status=="pending"?(d(),l("div",W,[t("div",X,[g(I,{class:"w-full",modelValue:s(e).discount_type,"onUpdate:modelValue":c[0]||(c[0]=o=>s(e).discount_type=o),items:i.discount_types,hideIcon:!0},null,8,["modelValue","items"]),g(A,{class:"mt-2",message:s(e).errors.discount_type},null,8,["message"])]),t("div",Y,[K(t("input",{"onUpdate:modelValue":c[1]||(c[1]=o=>s(e).discount_rate=o),onKeyup:c[2]||(c[2]=o=>F()),placeholder:[s(e).discount_type=="percent"?"Discount Rate in %":"Discount in amount"],type:"text",oninput:"this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\\..*?)\\..*/g, '$1');",autocomplete:"off",class:m(["block w-full px-4 text-left text-xs sm:text-sm border-stone-300 focus:ring-primary-400 focus:border-primary-400 hover:bg-stone-100 focus:bg-transparent rounded"])},null,40,tt),[[U,s(e).discount_rate]]),g(A,{class:"mt-2",message:s(e).errors.discount_rate},null,8,["message"])])])):y("",!0),t("div",et,[t("dl",st,[(d(),l(j,null,k(N,(o,n)=>t("div",{key:n,class:m([n%2==1?"bg-white":"bg-gray-50","px-0 py-2 sm:grid sm:grid-cols-3 sm:gap-4"])},[t("dt",ot,r(o.name),1),t("dd",at,[t("span",rt,r(o.value),1)])],2)),64)),t("div",nt,[it,t("dd",ct,[t("span",dt,r(s(e).sub_total),1)])]),t("div",lt,[mt,t("dd",ut,[t("span",pt,r(s(e).discount_amount),1)])]),t("div",_t,[gt,t("dd",xt,[t("span",ht,r(s(e).vat_amount),1)])]),t("div",bt,[yt,t("dd",ft,[t("span",vt,r(s(e).total_text),1)])])])]),t("div",wt,[t("h3",kt," # Order "+r(i.string_change.product_s),1)]),t("div",jt,[t("table",At,[Nt,t("tbody",Ft,[(d(!0),l(j,null,k(s(e).group_items,(o,n)=>(d(),l("tr",{key:n,class:m([n%2==0?"bg-white":"bg-gray-50","border-b border-gray-100 pl-0 p-3 text-gray-900"])},[t("td",Ot,r(o.product_name),1),t("td",Vt,r(o.rate),1),t("td",Dt,r(o.quantity),1),t("td",Tt,r(o.total),1)],2))),128))])])]),i.status=="pending"?(d(),l("div",zt,[t("button",{type:"button",onClick:O,disabled:s(e).processing,class:m({"opacity-25":s(e).processing,"inline-flex w-full uppercase justify-center rounded-md border border-transparent bg-green-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 sm:w-auto sm:text-sm":!0})},"Approve",10,Ct),t("button",{type:"button",onClick:V,disabled:s(e).processing,class:m({"opacity-25":s(e).processing,"mt-3 inline-flex w-full uppercase justify-center rounded-md border border-gray-300 bg-red-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm":!0})},"Reject",10,$t)])):y("",!0)])]),_:1}))}};export{Zt as default};
